<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸ªäººä¸­å¿ƒ - Splurge Vision</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(135deg, #EFE9E3 0%, #E2D8D0 25%, #D9CECA 50%, #C8B8B0 75%, #BFA99F 100%);
      background-attachment: fixed;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* ===== é¡¶éƒ¨ ===== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      margin-bottom: 30px;
    }

    .header h1 {
      color: #6B7B6D;
      font-size: 2rem;
      font-weight: 700;
    }

    .header-actions {
      display: flex;
      gap: 12px;
    }

    .back-btn, .cart-btn {
      padding: 12px 24px;
      background: linear-gradient(135deg, #9BA89C 0%, #6B7B6D 100%);
      color: white;
      text-decoration: none;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.3s;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      font-family: 'Montserrat', sans-serif;
    }

    .back-btn:hover, .cart-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(107, 123, 109, 0.4);
    }

    .cart-btn {
      background: linear-gradient(135deg, #C9A9A8 0%, #A88B8A 100%);
    }

    .logout-btn {
      padding: 12px 24px;
      background: rgba(200, 100, 100, 0.75);
      color: white;
      text-decoration: none;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.3s;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      font-family: 'Montserrat', sans-serif;
    }

    .logout-btn:hover {
      background: rgba(200, 100, 100, 0.95);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(200, 100, 100, 0.3);
    }

    /* ===== Tab å¯¼èˆª ===== */
    .tab-nav {
      display: flex;
      gap: 0;
      margin-bottom: 24px;
      background: rgba(255,255,255,0.6);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    }

    .tab-btn {
      flex: 1;
      padding: 16px 20px;
      background: transparent;
      border: none;
      font-size: 1rem;
      font-weight: 600;
      color: #8B9B8D;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Montserrat', sans-serif;
      position: relative;
    }

    .tab-btn:hover {
      color: #6B7B6D;
      background: rgba(155, 168, 156, 0.1);
    }

    .tab-btn.active {
      color: #6B7B6D;
      background: rgba(255,255,255,0.9);
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .tab-btn.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 20%;
      width: 60%;
      height: 3px;
      background: linear-gradient(135deg, #9BA89C 0%, #6B7B6D 100%);
      border-radius: 3px;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* ===== é€šç”¨å¡ç‰‡ ===== */
    .profile-card {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .section-title {
      color: #6B7B6D;
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-dot {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      box-shadow: 0 0 6px 3px rgba(0,0,0,0.08);
      vertical-align: middle;
    }

    /* ===== ä¸ªäººèµ„æ–™ Tab ===== */
    .profile-top-grid {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .user-info {
      text-align: center;
    }

    .user-avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: linear-gradient(135deg, #9BA89C 0%, #6B7B6D 100%);
      margin: 0 auto 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      color: white;
    }

    .user-name {
      font-size: 1.4rem;
      color: #6B7B6D;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .user-phone {
      color: #8B9B8D;
      font-size: 0.9rem;
      margin-bottom: 6px;
    }

    .points-section {
      background: linear-gradient(135deg, rgba(155, 168, 156, 0.15) 0%, rgba(107, 123, 109, 0.1) 100%);
      border-radius: 14px;
      padding: 16px;
      margin-top: 16px;
    }

    .points-display {
      text-align: center;
      padding: 10px;
    }

    .points-number {
      font-size: 2.2rem;
      color: #6B7B6D;
      font-weight: 900;
      margin-bottom: 4px;
    }

    .points-label {
      color: #8B9B8D;
      font-size: 0.85rem;
    }

    .points-rules {
      margin-top: 14px;
      padding-top: 14px;
      border-top: 1px solid rgba(107, 123, 109, 0.15);
    }

    .points-rules h3 {
      color: #6B7B6D;
      font-size: 0.95rem;
      margin-bottom: 8px;
      font-weight: 700;
    }

    .points-rules ul {
      list-style: none;
      padding: 0;
    }

    .points-rules li {
      color: #6B7B6D;
      font-size: 0.82rem;
      padding: 4px 0;
      padding-left: 18px;
      position: relative;
    }

    .points-rules li:before {
      content: "âœ“";
      position: absolute;
      left: 0;
      color: #9BA89C;
      font-weight: bold;
    }

    .birthday-reminder {
      background: linear-gradient(135deg, rgba(255, 200, 150, 0.3) 0%, rgba(255, 180, 120, 0.2) 100%);
      border-left: 4px solid #FFA500;
      padding: 12px;
      border-radius: 8px;
      margin-top: 12px;
      font-size: 0.82rem;
      color: #6B7B6D;
    }

    .birthday-reminder strong {
      color: #FF8C00;
    }

    /* ä¸ªäººåŸºæœ¬ä¿¡æ¯å±•ç¤º */
    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .info-item {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .info-item.full-width {
      grid-column: 1 / -1;
    }

    .info-label {
      font-size: 0.85rem;
      color: #8B9B8D;
      font-weight: 600;
    }

    .info-value {
      font-size: 1rem;
      color: #6B7B6D;
      font-weight: 600;
      padding: 10px 14px;
      background: rgba(155, 168, 156, 0.08);
      border-radius: 10px;
      border: 1.5px solid rgba(107, 123, 109, 0.12);
    }

    .btn-edit-profile {
      display: inline-block;
      margin-top: 16px;
      padding: 10px 24px;
      background: linear-gradient(135deg, #9BA89C 0%, #6B7B6D 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Montserrat', sans-serif;
    }

    .btn-edit-profile:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(107, 123, 109, 0.4);
    }

    /* ===== éªŒå…‰å¤„æ–¹ ===== */
    .prescription-card {
      margin-top: 0;
    }

    .prescription-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      overflow: hidden;
      border-radius: 12px;
      border: 1.5px solid rgba(107, 123, 109, 0.15);
    }

    .prescription-table th,
    .prescription-table td {
      padding: 12px 16px;
      text-align: center;
      font-size: 0.9rem;
    }

    .prescription-table thead th {
      background: linear-gradient(135deg, rgba(155, 168, 156, 0.2) 0%, rgba(107, 123, 109, 0.15) 100%);
      color: #6B7B6D;
      font-weight: 700;
      font-size: 0.85rem;
      border-bottom: 1.5px solid rgba(107, 123, 109, 0.15);
    }

    .prescription-table tbody td {
      color: #6B7B6D;
      font-weight: 600;
      border-bottom: 1px solid rgba(107, 123, 109, 0.08);
    }

    .prescription-table tbody tr:last-child td {
      border-bottom: none;
    }

    .prescription-table .eye-label {
      font-weight: 700;
      color: #6B7B6D;
      background: rgba(155, 168, 156, 0.06);
      text-align: left;
      padding-left: 20px;
    }

    .prescription-empty {
      text-align: center;
      padding: 30px;
      color: #8B9B8D;
      font-size: 0.95rem;
    }

    .prescription-note {
      margin-top: 14px;
      padding: 12px 16px;
      background: rgba(155, 168, 156, 0.08);
      border-radius: 10px;
      font-size: 0.82rem;
      color: #8B9B8D;
      line-height: 1.7;
    }

    .prescription-actions {
      display: flex;
      gap: 10px;
      margin-top: 16px;
    }

    /* ===== è´­ä¹°è®°å½• Tab ===== */
    .order-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .order-item {
      background: rgba(255, 255, 255, 0.5);
      border-radius: 14px;
      padding: 20px;
      border: 1.5px solid rgba(107, 123, 109, 0.1);
      transition: all 0.3s;
    }

    .order-item:hover {
      border-color: rgba(107, 123, 109, 0.25);
      box-shadow: 0 2px 12px rgba(107, 123, 109, 0.1);
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(107, 123, 109, 0.1);
    }

    .order-id {
      font-size: 0.85rem;
      color: #8B9B8D;
      font-weight: 600;
    }

    .order-date {
      font-size: 0.82rem;
      color: #A8B5A0;
    }

    .order-status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.78rem;
      font-weight: 600;
    }

    .status-completed {
      background: rgba(155, 168, 156, 0.2);
      color: #6B7B6D;
    }

    .status-shipping {
      background: rgba(201, 169, 168, 0.2);
      color: #A88B8A;
    }

    .status-processing {
      background: rgba(212, 201, 168, 0.3);
      color: #8A7E5A;
    }

    .order-products {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .order-product {
      display: flex;
      gap: 14px;
      align-items: center;
    }

    .order-product-img {
      width: 70px;
      height: 70px;
      border-radius: 10px;
      object-fit: cover;
      background: rgba(155,168,156,0.1);
    }

    .order-product-info {
      flex: 1;
    }

    .order-product-name {
      font-size: 0.95rem;
      color: #6B7B6D;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .order-product-spec {
      font-size: 0.82rem;
      color: #8B9B8D;
      margin-bottom: 2px;
    }

    .order-product-price {
      font-size: 1rem;
      color: #6B7B6D;
      font-weight: 700;
    }

    .order-product-qty {
      font-size: 0.85rem;
      color: #8B9B8D;
      font-weight: 600;
    }

    .order-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 14px;
      padding-top: 12px;
      border-top: 1px solid rgba(107, 123, 109, 0.1);
    }

    .order-total {
      font-size: 1.1rem;
      color: #6B7B6D;
      font-weight: 700;
    }

    .order-total span {
      font-size: 0.85rem;
      font-weight: 400;
      color: #8B9B8D;
      margin-right: 6px;
    }

    .order-actions {
      display: flex;
      gap: 8px;
    }

    .order-empty {
      text-align: center;
      padding: 60px 20px;
      color: #8B9B8D;
    }

    .order-empty-icon {
      font-size: 3rem;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .order-empty p {
      font-size: 1rem;
      margin-bottom: 20px;
    }

    .go-shop-btn {
      display: inline-block;
      padding: 12px 30px;
      background: linear-gradient(135deg, #9BA89C 0%, #6B7B6D 100%);
      color: white;
      text-decoration: none;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.3s;
    }

    .go-shop-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(107, 123, 109, 0.4);
    }

    /* ===== åœ°å€ç®¡ç† Tab ===== */
    .address-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .address-item {
      background: rgba(255, 255, 255, 0.5);
      border-radius: 12px;
      padding: 20px;
      border: 2px solid transparent;
      transition: all 0.3s;
      position: relative;
    }

    .address-item.default {
      border-color: #9BA89C;
    }

    .address-item:hover {
      border-color: #6B7B6D;
      box-shadow: 0 2px 10px rgba(107, 123, 109, 0.2);
    }

    .address-badge {
      display: inline-block;
      background: linear-gradient(135deg, #9BA89C 0%, #6B7B6D 100%);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .address-name {
      font-size: 1.1rem;
      color: #6B7B6D;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .address-phone {
      color: #8B9B8D;
      font-size: 0.9rem;
      margin-bottom: 8px;
    }

    .address-detail {
      color: #6B7B6D;
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .address-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Montserrat', sans-serif;
    }

    .btn-edit {
      background: linear-gradient(135deg, #9BA89C 0%, #6B7B6D 100%);
      color: white;
    }

    .btn-delete {
      background: rgba(200, 100, 100, 0.8);
      color: white;
    }

    .btn-default {
      background: rgba(155, 168, 156, 0.3);
      color: #6B7B6D;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .add-address-btn {
      width: 100%;
      padding: 15px;
      background: rgba(155, 168, 156, 0.15);
      border: 2px dashed rgba(155, 168, 156, 0.5);
      border-radius: 12px;
      color: #6B7B6D;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      font-family: 'Montserrat', sans-serif;
    }

    .add-address-btn:hover {
      background: rgba(155, 168, 156, 0.3);
      border-color: #6B7B6D;
    }

    /* ===== æ¨¡æ€æ¡† ===== */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
    }

    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      width: 90%;
      max-width: 500px;
      max-height: 85vh;
      overflow-y: auto;
    }

    .modal-close {
      position: absolute;
      right: 20px;
      top: 20px;
      font-size: 28px;
      font-weight: bold;
      color: #999;
      cursor: pointer;
      transition: color 0.2s;
    }

    .modal-close:hover {
      color: #333;
    }

    .modal-title {
      text-align: center;
      font-size: 1.5rem;
      color: #6B7B6D;
      margin-bottom: 25px;
      font-weight: 700;
    }

    .form-group {
      margin-bottom: 18px;
    }

    .form-label {
      display: block;
      color: #6B7B6D;
      font-size: 0.88rem;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .form-input, .form-select {
      width: 100%;
      padding: 11px 14px;
      border: 2px solid rgba(107, 123, 109, 0.25);
      border-radius: 10px;
      font-size: 0.95rem;
      transition: all 0.3s;
      background: rgba(255, 255, 255, 0.8);
      font-family: 'Montserrat', sans-serif;
      color: #6B7B6D;
    }

    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: #6B7B6D;
      background: white;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .form-hint {
      font-size: 0.78rem;
      color: #A8B5A0;
      margin-top: 4px;
    }

    .form-submit {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #9BA89C 0%, #6B7B6D 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1.05rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 10px;
      font-family: 'Montserrat', sans-serif;
    }

    .form-submit:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(107, 123, 109, 0.4);
    }

    /* ===== å“åº”å¼ ===== */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 12px;
        text-align: center;
      }

      .header h1 {
        font-size: 1.5rem;
      }

      .header-actions {
        width: 100%;
        justify-content: center;
      }

      .tab-nav {
        flex-direction: column;
        border-radius: 12px;
      }

      .tab-btn {
        padding: 12px 16px;
      }

      .tab-btn.active::after {
        display: none;
      }

      .profile-top-grid {
        grid-template-columns: 1fr;
      }

      .info-grid {
        grid-template-columns: 1fr;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .prescription-table {
        font-size: 0.82rem;
      }

      .prescription-table th,
      .prescription-table td {
        padding: 8px 10px;
        font-size: 0.82rem;
      }

      .order-product {
        flex-direction: column;
        align-items: flex-start;
      }

      .order-product-img {
        width: 100%;
        height: 120px;
      }

      .order-header {
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
      }

      .order-footer {
        flex-direction: column;
        gap: 12px;
        align-items: flex-start;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 12px;
      }

      .profile-card {
        padding: 20px;
        border-radius: 14px;
      }

      .modal-content {
        padding: 25px;
      }

      .back-btn, .cart-btn {
        padding: 10px 16px;
        font-size: 0.88rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- é¡¶éƒ¨ -->
    <div class="header">
      <h1>ä¸ªäººä¸­å¿ƒ</h1>
      <div class="header-actions">
        <a href="cart.html" class="cart-btn">ğŸ›’ è´­ç‰©è½¦</a>
        <a href="index.html" class="back-btn">è¿”å›é¦–é¡µ</a>
        <button class="logout-btn" onclick="handleLogout()">é€€å‡ºç™»å½•</button>
      </div>
    </div>

    <!-- Tab å¯¼èˆª -->
    <div class="tab-nav">
      <button class="tab-btn active" data-tab="profile" onclick="switchTab('profile', this)">
        <span class="section-dot" style="background:#A8B5A0;box-shadow:0 0 6px 3px rgba(168,181,160,0.4);margin-right:6px;"></span>
        ä¸ªäººèµ„æ–™
      </button>
      <button class="tab-btn" data-tab="orders" onclick="switchTab('orders', this)">
        <span class="section-dot" style="background:#C9A9A8;box-shadow:0 0 6px 3px rgba(201,169,168,0.4);margin-right:6px;"></span>
        è´­ä¹°è®°å½•
      </button>
      <button class="tab-btn" data-tab="address" onclick="switchTab('address', this)">
        <span class="section-dot" style="background:#9EAFC2;box-shadow:0 0 6px 3px rgba(158,175,194,0.4);margin-right:6px;"></span>
        æ”¶è´§åœ°å€
      </button>
    </div>

    <!-- ==================== ä¸ªäººèµ„æ–™ Tab ==================== -->
    <div id="tab-profile" class="tab-content active">
      <div class="profile-top-grid">
        <!-- å·¦ï¼šå¤´åƒä¸ç§¯åˆ† -->
        <div class="profile-card user-info">
          <div class="user-avatar">ğŸ‘¤</div>
                    <div class="user-avatar" id="userAvatar" onclick="openAvatarModal()" style="cursor:pointer;">ğŸ‘¤<div class="avatar-edit-tip">ç‚¹å‡»æ›´æ¢å¤´åƒ</div></div>
          <!-- å¤´åƒä¸Šä¼ æ¨¡æ€æ¡† -->
          <div id="avatarModal" class="modal" style="display:none;z-index:1002;">
            <div class="modal-content" style="max-width:400px;text-align:center;">
              <div class="modal-header">
                <h2>æ›´æ¢å¤´åƒ</h2>
                <span class="close" onclick="closeAvatarModal()">&times;</span>
              </div>
              <div style="margin:20px 0;">
                <input type="file" accept="image/*" id="avatarFileInput" style="display:none;" onchange="handleAvatarUpload(event)">
                <button onclick="document.getElementById('avatarFileInput').click()" class="btn-edit-profile" style="margin-bottom:18px;">ä»ç›¸å†Œé€‰æ‹©å›¾ç‰‡</button>
                <div id="avatarPreview" style="margin:0 auto;width:120px;height:120px;border-radius:50%;background:#eee;display:flex;align-items:center;justify-content:center;overflow:hidden;font-size:2.5rem;"></div>
              </div>
              <button onclick="saveAvatar()" class="btn-edit-profile" style="width:100%;">ä¿å­˜å¤´åƒ</button>
            </div>
          </div>
          <style>
          .avatar-edit-tip {font-size:0.8rem;color:#8B9B8D;margin-top:4px;}
          #avatarPreview img {width:100%;height:100%;object-fit:cover;}
          </style>
          <script>
          function openAvatarModal() {
            document.getElementById('avatarModal').style.display = 'block';
            // æ˜¾ç¤ºå½“å‰å¤´åƒ
            const user = JSON.parse(localStorage.getItem('splurgeVisionUser')||'{}');
            const preview = document.getElementById('avatarPreview');
            preview.innerHTML = user.avatar ? `<img src="${user.avatar}" alt="avatar">` : 'ğŸ‘¤';
          }
          function closeAvatarModal() {
            document.getElementById('avatarModal').style.display = 'none';
          }
          function handleAvatarUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(evt) {
              document.getElementById('avatarPreview').innerHTML = `<img src="${evt.target.result}" alt="avatar">`;
              document.getElementById('avatarPreview').dataset.avatar = evt.target.result;
            };
            reader.readAsDataURL(file);
          }
          function saveAvatar() {
            const dataUrl = document.getElementById('avatarPreview').dataset.avatar;
            if (!dataUrl) { alert('è¯·å…ˆé€‰æ‹©å›¾ç‰‡'); return; }
            // å­˜å‚¨åˆ°localStorage
            let user = JSON.parse(localStorage.getItem('splurgeVisionUser')||'{}');
            user.avatar = dataUrl;
            localStorage.setItem('splurgeVisionUser', JSON.stringify(user));
            // æ›´æ–°é¡µé¢å¤´åƒ
            document.getElementById('userAvatar').innerHTML = `<img src="${dataUrl}" alt="avatar" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`;
            document.getElementById('userAvatar').appendChild(document.createElement('div')).className = 'avatar-edit-tip';
            document.getElementById('userAvatar').querySelector('.avatar-edit-tip').textContent = 'ç‚¹å‡»æ›´æ¢å¤´åƒ';
            closeAvatarModal();
          }
          </script>
          <div class="user-name" id="userName">ç”¨æˆ·å</div>
          <div class="user-phone" id="userPhone">138****8888</div>
          <div class="user-phone" style="margin-top:4px;">ğŸ‚ ç”Ÿæ—¥ï¼š<span id="userBirthday">1990-01-01</span></div>

          <div class="points-section">
            <div class="points-display">
              <div class="points-number" id="userPoints">0</div>
              <div class="points-label">æˆ‘çš„ç§¯åˆ†</div>
            </div>
            <div class="points-rules">
              <h3>ç§¯åˆ†è§„åˆ™</h3>
              <ul>
                <li>æ¶ˆè´¹1å…ƒç§¯1åˆ†</li>
                <li>100ç§¯åˆ†æŠµæ‰£1å…ƒï¼Œæ— é—¨æ§›</li>
                <li>ç”Ÿæ—¥å½“å¤©åŒå€ç§¯åˆ†</li>
                <li>ç§¯åˆ†æ°¸ä¹…æœ‰æ•ˆ</li>
              </ul>
            </div>
            <div class="birthday-reminder" id="birthdayReminder" style="display:none;">
              <strong>ğŸ‰ ä»Šå¤©æ˜¯æ‚¨çš„ç”Ÿæ—¥ï¼</strong><br>
              ç”Ÿæ—¥å½“å¤©æ¶ˆè´¹å¯äº«å—åŒå€ç§¯åˆ†å“¦ï¼
            </div>
          </div>
        </div>

        <!-- å³ï¼šåŸºæœ¬ä¿¡æ¯ -->
        <div class="profile-card">
          <h2 class="section-title">
            <span class="section-dot" style="background:#A8B5A0;"></span>
            åŸºæœ¬ä¿¡æ¯
          </h2>
          <div class="info-grid" id="profileInfoGrid">
            <div class="info-item">
              <span class="info-label">å§“å</span>
              <div class="info-value" id="infoName">â€”</div>
            </div>
            <div class="info-item">
              <span class="info-label">æ‰‹æœºå·ç </span>
              <div class="info-value" id="infoPhone">â€”</div>
            </div>
            <div class="info-item">
              <span class="info-label">ç”Ÿæ—¥</span>
              <div class="info-value" id="infoBirthday">â€”</div>
            </div>
            <div class="info-item">
              <span class="info-label">æ€§åˆ«</span>
              <div class="info-value" id="infoGender">â€”</div>
            </div>
            <div class="info-item full-width">
              <span class="info-label">é‚®ç®±</span>
              <div class="info-value" id="infoEmail">â€”</div>
            </div>
          </div>
          <button class="btn-edit-profile" onclick="openEditProfileModal()">ç¼–è¾‘ä¸ªäººä¿¡æ¯</button>
        </div>
      </div>

      <!-- éªŒå…‰å¤„æ–¹ -->
      <div class="profile-card prescription-card">
        <h2 class="section-title">
          <span class="section-dot" style="background:#C4B8A0;"></span>
          æˆ‘çš„éªŒå…‰å¤„æ–¹
        </h2>

        <div id="prescriptionContent">
          <!-- ç”±JSåŠ¨æ€å¡«å…… -->
        </div>

        <div class="prescription-note">
          <strong>æ¸©é¦¨æç¤ºï¼š</strong>è¯·ä¸Šä¼ æ‚¨æœ€è¿‘6ä¸ªæœˆå†…çš„éªŒå…‰å•æ•°æ®ã€‚å‡†ç¡®çš„å¤„æ–¹ä¿¡æ¯å°†å¸®åŠ©æˆ‘ä»¬ä¸ºæ‚¨é…åˆ¶æœ€åˆé€‚çš„é•œç‰‡ã€‚<br>
          â€¢ SPHï¼ˆçƒé•œ/è¿‘è§†åº¦æ•°ï¼‰ï¼šè´Ÿå€¼ä¸ºè¿‘è§†ï¼Œæ­£å€¼ä¸ºè¿œè§†ï¼Œå¦‚ -3.00 è¡¨ç¤º300åº¦è¿‘è§†<br>
          â€¢ CYLï¼ˆæŸ±é•œ/æ•£å…‰åº¦æ•°ï¼‰ï¼šå¦‚ -0.75 è¡¨ç¤º75åº¦æ•£å…‰<br>
          â€¢ AXISï¼ˆè½´ä½ï¼‰ï¼šæ•£å…‰æ–¹å‘ï¼ŒèŒƒå›´ 1Â°~180Â°<br>
          â€¢ PDï¼ˆç³è·ï¼‰ï¼šåŒçœ¼ç³å­”é—´çš„è·ç¦»ï¼Œå•ä½æ¯«ç±³
        </div>

        <div class="prescription-actions">
          <button class="btn-edit-profile" onclick="openPrescriptionModal()">ç¼–è¾‘å¤„æ–¹</button>
        </div>
      </div>
    </div>

    <!-- ==================== è´­ä¹°è®°å½• Tab ==================== -->
    <div id="tab-orders" class="tab-content">
      <div class="profile-card">
        <h2 class="section-title">
          <span class="section-dot" style="background:#C9A9A8;"></span>
          è´­ä¹°è®°å½•
        </h2>
        <div class="order-list" id="orderList">
          <!-- ç”±JSåŠ¨æ€å¡«å…… -->
        </div>
      </div>
    </div>

    <!-- ==================== æ”¶è´§åœ°å€ Tab ==================== -->
    <div id="tab-address" class="tab-content">
      <div class="profile-card">
        <h2 class="section-title">
          <span class="section-dot" style="background:#9EAFC2;"></span>
          æ”¶è´§åœ°å€ç®¡ç†
        </h2>
        
        <div class="address-list" id="addressList">
          <!-- ç”±JSåŠ¨æ€å¡«å…… -->
        </div>

        <button class="add-address-btn" onclick="openAddAddressModal()" style="margin-top:15px;">
          <span style="font-size:1.5rem;">+</span>
          æ·»åŠ æ–°åœ°å€
        </button>
      </div>
    </div>
  </div>

  <!-- ==================== ç¼–è¾‘ä¸ªäººä¿¡æ¯æ¨¡æ€æ¡† ==================== -->
  <div id="profileModal" class="modal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeModal('profileModal')">&times;</span>
      <h2 class="modal-title">ç¼–è¾‘ä¸ªäººä¿¡æ¯</h2>
      <form id="profileForm" onsubmit="saveProfile(event)">
        <div class="form-group">
          <label class="form-label">å§“å</label>
          <input type="text" class="form-input" id="editName" placeholder="è¯·è¾“å…¥å§“å" required>
        </div>
        <div class="form-group">
          <label class="form-label">æ‰‹æœºå·ç </label>
          <input type="tel" class="form-input" id="editPhone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·ç " required>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">ç”Ÿæ—¥</label>
            <input type="date" class="form-input" id="editBirthday">
          </div>
          <div class="form-group">
            <label class="form-label">æ€§åˆ«</label>
            <select class="form-input" id="editGender">
              <option value="">è¯·é€‰æ‹©</option>
              <option value="ç”·">ç”·</option>
              <option value="å¥³">å¥³</option>
              <option value="ä¸æ„¿é€éœ²">ä¸æ„¿é€éœ²</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">é‚®ç®±</label>
          <input type="email" class="form-input" id="editEmail" placeholder="è¯·è¾“å…¥é‚®ç®±">
        </div>
        <button type="submit" class="form-submit">ä¿å­˜ä¿¡æ¯</button>
      </form>
    </div>
  </div>

  <!-- ==================== ç¼–è¾‘éªŒå…‰å¤„æ–¹æ¨¡æ€æ¡† ==================== -->
  <div id="prescriptionModal" class="modal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeModal('prescriptionModal')">&times;</span>
      <h2 class="modal-title">ç¼–è¾‘éªŒå…‰å¤„æ–¹</h2>
      <form id="prescriptionForm" onsubmit="savePrescription(event)">
        <p style="text-align:center;color:#8B9B8D;font-size:0.9rem;margin-bottom:20px;">è¯·æ ¹æ®æ‚¨çš„éªŒå…‰å•å¡«å†™ä»¥ä¸‹ä¿¡æ¯</p>
        
        <h3 style="color:#6B7B6D;font-size:0.95rem;margin-bottom:12px;">ğŸ‘ å³çœ¼ (OD)</h3>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">çƒé•œ SPH</label>
            <input type="text" class="form-input" id="rxRSph" placeholder="å¦‚ -3.00">
            <div class="form-hint">è¿‘è§†ä¸ºè´Ÿå€¼ï¼Œè¿œè§†ä¸ºæ­£å€¼</div>
          </div>
          <div class="form-group">
            <label class="form-label">æŸ±é•œ CYL</label>
            <input type="text" class="form-input" id="rxRCyl" placeholder="å¦‚ -0.75">
            <div class="form-hint">æ•£å…‰åº¦æ•°</div>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">è½´ä½ AXIS</label>
          <input type="text" class="form-input" id="rxRAxis" placeholder="å¦‚ 180">
          <div class="form-hint">èŒƒå›´ 1Â° ~ 180Â°</div>
        </div>

        <h3 style="color:#6B7B6D;font-size:0.95rem;margin:20px 0 12px;">ğŸ‘ å·¦çœ¼ (OS)</h3>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">çƒé•œ SPH</label>
            <input type="text" class="form-input" id="rxLSph" placeholder="å¦‚ -2.50">
          </div>
          <div class="form-group">
            <label class="form-label">æŸ±é•œ CYL</label>
            <input type="text" class="form-input" id="rxLCyl" placeholder="å¦‚ -0.50">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">è½´ä½ AXIS</label>
          <input type="text" class="form-input" id="rxLAxis" placeholder="å¦‚ 175">
        </div>

        <h3 style="color:#6B7B6D;font-size:0.95rem;margin:20px 0 12px;">ğŸ“ å…¶ä»–å‚æ•°</h3>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">ç³è· PD (mm)</label>
            <input type="text" class="form-input" id="rxPD" placeholder="å¦‚ 63">
            <div class="form-hint">æˆäººä¸€èˆ¬58~70mm</div>
          </div>
          <div class="form-group">
            <label class="form-label">ç³é«˜ PH (mm)</label>
            <input type="text" class="form-input" id="rxPH" placeholder="é€‰å¡«">
            <div class="form-hint">æ¸è¿›ç‰‡éœ€è¦</div>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">ADDï¼ˆè€èŠ±é™„åŠ åº¦æ•°ï¼‰</label>
          <input type="text" class="form-input" id="rxAdd" placeholder="é€‰å¡«ï¼Œå¦‚ +1.50">
          <div class="form-hint">æ¸è¿›å¤šç„¦ç‚¹é•œç‰‡éœ€è¦</div>
        </div>
        <div class="form-group">
          <label class="form-label">å¤‡æ³¨</label>
          <input type="text" class="form-input" id="rxNote" placeholder="å…¶ä»–éœ€è¦è¯´æ˜çš„ä¿¡æ¯">
        </div>

        <button type="submit" class="form-submit">ä¿å­˜å¤„æ–¹</button>
      </form>
    </div>
  </div>

  <!-- ==================== æ·»åŠ /ç¼–è¾‘åœ°å€æ¨¡æ€æ¡† ==================== -->
  <div id="addressModal" class="modal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeModal('addressModal')">&times;</span>
      <h2 class="modal-title" id="addressModalTitle">æ·»åŠ æ”¶è´§åœ°å€</h2>
      <form id="addressForm" onsubmit="saveAddress(event)">
        <input type="hidden" id="editIndex" value="-1">
        
        <div class="form-group">
          <label class="form-label">æ”¶è´§äººå§“å</label>
          <input type="text" class="form-input" id="addressName" placeholder="è¯·è¾“å…¥æ”¶è´§äººå§“å" required>
        </div>

        <div class="form-group">
          <label class="form-label">è”ç³»ç”µè¯</label>
          <input type="tel" class="form-input" id="addressFormPhone" placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯" required>
        </div>

        <div class="form-group">
          <label class="form-label">å›½å®¶/åœ°åŒº</label>
          <select class="form-input" id="addressCountry" onchange="updateAddressProvinces()" required>
            <option value="">é€‰æ‹©å›½å®¶/åœ°åŒº</option>
            <option value="ä¸­å›½å¤§é™†">ä¸­å›½å¤§é™†</option>
            <option value="é¦™æ¸¯">é¦™æ¸¯</option>
            <option value="æ¾³é—¨">æ¾³é—¨</option>
            <option value="å°æ¹¾">å°æ¹¾</option>
            <option value="æ—¥æœ¬">æ—¥æœ¬</option>
            <option value="éŸ©å›½">éŸ©å›½</option>
            <option value="è‹±å›½">è‹±å›½</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">çœä»½/å·</label>
          <select class="form-input" id="addressProvince" onchange="updateAddressCities()" required>
            <option value="">è¯·å…ˆé€‰æ‹©å›½å®¶</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">åŸå¸‚</label>
          <select class="form-input" id="addressCity" required>
            <option value="">è¯·å…ˆé€‰æ‹©çœä»½</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">è¯¦ç»†åœ°å€</label>
          <input type="text" class="form-input" id="addressDetail" placeholder="è¡—é“ã€é—¨ç‰Œå·ç­‰" required>
        </div>

        <button type="submit" class="form-submit">ä¿å­˜åœ°å€</button>
      </form>
    </div>
  </div>

  <script>
    // ==================== åœ°å€æ•°æ®åº“ ====================
    const addressData = {
      'ä¸­å›½å¤§é™†': {
        'åŒ—äº¬å¸‚': ['ä¸œåŸåŒº', 'è¥¿åŸåŒº', 'æœé˜³åŒº', 'æµ·æ·€åŒº', 'ä¸°å°åŒº', 'çŸ³æ™¯å±±åŒº', 'é—¨å¤´æ²ŸåŒº', 'æˆ¿å±±åŒº', 'é€šå·åŒº', 'é¡ºä¹‰åŒº', 'æ˜Œå¹³åŒº', 'å¤§å…´åŒº', 'å¹³è°·åŒº', 'æ€€æŸ”åŒº', 'å¯†äº‘åŒº', 'å»¶åº†åŒº'],
        'ä¸Šæµ·å¸‚': ['é»„æµ¦åŒº', 'å¾æ±‡åŒº', 'é•¿å®åŒº', 'é™å®‰åŒº', 'æ™®é™€åŒº', 'è™¹å£åŒº', 'æ¨æµ¦åŒº', 'æµ¦ä¸œæ–°åŒº', 'é—µè¡ŒåŒº', 'å®å±±åŒº', 'å˜‰å®šåŒº', 'é‡‘å±±åŒº', 'æ¾æ±ŸåŒº', 'é’æµ¦åŒº', 'å¥‰è´¤åŒº', 'å´‡æ˜åŒº'],
        'å¹¿ä¸œçœ': ['å¹¿å·å¸‚', 'æ·±åœ³å¸‚', 'ç æµ·å¸‚', 'ä¸œèå¸‚', 'ä½›å±±å¸‚', 'ä¸­å±±å¸‚', 'æƒ å·å¸‚', 'æ±•å¤´å¸‚', 'æ±Ÿé—¨å¸‚', 'è‚‡åº†å¸‚'],
        'æµ™æ±Ÿçœ': ['æ­å·å¸‚', 'å®æ³¢å¸‚', 'æ¸©å·å¸‚', 'å˜‰å…´å¸‚', 'æ¹–å·å¸‚', 'ç»å…´å¸‚', 'é‡‘åå¸‚', 'å°å·å¸‚'],
        'æ±Ÿè‹çœ': ['å—äº¬å¸‚', 'è‹å·å¸‚', 'æ— é”¡å¸‚', 'å¸¸å·å¸‚', 'å—é€šå¸‚', 'æ‰¬å·å¸‚', 'å¾å·å¸‚', 'ç›åŸå¸‚'],
        'æ¹–åŒ—çœ': ['æ­¦æ±‰å¸‚', 'å®œæ˜Œå¸‚', 'è¥„é˜³å¸‚', 'è†å·å¸‚', 'åå °å¸‚', 'å­æ„Ÿå¸‚'],
        'æ¹–å—çœ': ['é•¿æ²™å¸‚', 'æ ªæ´²å¸‚', 'å²³é˜³å¸‚', 'è¡¡é˜³å¸‚', 'é‚µé˜³å¸‚', 'å¸¸å¾·å¸‚'],
        'å››å·çœ': ['æˆéƒ½å¸‚', 'ç»µé˜³å¸‚', 'å¾·é˜³å¸‚', 'å—å……å¸‚', 'ä¹å±±å¸‚', 'å®œå®¾å¸‚'],
        'å±±ä¸œçœ': ['æµå—å¸‚', 'é’å²›å¸‚', 'çƒŸå°å¸‚', 'å¨æµ·å¸‚', 'æ½åŠå¸‚', 'æ·„åšå¸‚'],
        'ç¦å»ºçœ': ['ç¦å·å¸‚', 'å¦é—¨å¸‚', 'æ³‰å·å¸‚', 'æ¼³å·å¸‚', 'è†ç”°å¸‚']
      },
      'é¦™æ¸¯': {
        'é¦™æ¸¯å²›': ['ä¸­è¥¿åŒº', 'æ¹¾ä»”åŒº', 'ä¸œåŒº', 'å—åŒº'],
        'ä¹é¾™': ['æ²¹å°–æ—ºåŒº', 'æ·±æ°´åŸ—åŒº', 'ä¹é¾™åŸåŒº', 'é»„å¤§ä»™åŒº', 'è§‚å¡˜åŒº'],
        'æ–°ç•Œ': ['èƒæ¹¾åŒº', 'å±¯é—¨åŒº', 'å…ƒæœ—åŒº', 'åŒ—åŒº', 'å¤§åŸ”åŒº', 'æ²™ç”°åŒº']
      },
      'æ¾³é—¨': {
        'æ¾³é—¨åŠå²›': ['èŠ±åœ°ç›å ‚åŒº', 'åœ£å®‰å¤šå°¼å ‚åŒº', 'å¤§å ‚åŒº', 'æœ›å¾·å ‚åŒº', 'é£é¡ºå ‚åŒº'],
        'ç¦»å²›': ['å˜‰æ¨¡å ‚åŒº', 'åœ£æ–¹æµå„å ‚åŒº']
      },
      'å°æ¹¾': {
        'å°åŒ—å¸‚': ['ä¸­æ­£åŒº', 'å¤§åŒåŒº', 'ä¸­å±±åŒº', 'æ¾å±±åŒº', 'å¤§å®‰åŒº', 'ä¸‡ååŒº'],
        'æ–°åŒ—å¸‚': ['æ¿æ¡¥åŒº', 'ä¸‰é‡åŒº', 'ä¸­å’ŒåŒº', 'æ°¸å’ŒåŒº', 'æ–°åº„åŒº', 'æ–°åº—åŒº'],
        'å°ä¸­å¸‚': ['ä¸­åŒº', 'ä¸œåŒº', 'å—åŒº', 'è¥¿åŒº', 'åŒ—åŒº', 'è¥¿å±¯åŒº']
      },
      'æ—¥æœ¬': {
        'ä¸œäº¬éƒ½': ['åƒä»£ç”°åŒº', 'ä¸­å¤®åŒº', 'æ¸¯åŒº', 'æ–°å®¿åŒº', 'æ¶©è°·åŒº', 'å“å·åŒº'],
        'å¤§é˜ªåºœ': ['å¤§é˜ªå¸‚', 'å ºå¸‚', 'ä¸œå¤§é˜ªå¸‚', 'è±Šä¸­å¸‚'],
        'äº¬éƒ½åºœ': ['äº¬éƒ½å¸‚', 'å®‡æ²»å¸‚', 'äº€å²¡å¸‚']
      },
      'éŸ©å›½': {
        'é¦–å°”ç‰¹åˆ«å¸‚': ['æ±Ÿå—åŒº', 'æ±ŸåŒ—åŒº', 'éº»æµ¦åŒº', 'é’Ÿè·¯åŒº', 'ä¸­åŒº'],
        'é‡œå±±å¹¿åŸŸå¸‚': ['æµ·äº‘å°åŒº', 'å—åŒº', 'ä¸œåŒº', 'è¥¿åŒº', 'ä¸­åŒº'],
        'ä»å·å¹¿åŸŸå¸‚': ['ä¸­åŒº', 'ä¸œåŒº', 'å—åŒº', 'å»¶å¯¿åŒº']
      },
      'è‹±å›½': {
        'è‹±æ ¼å…°': ['ä¼¦æ•¦', 'æ›¼å½»æ–¯ç‰¹', 'ä¼¯æ˜ç¿°', 'åˆ©å…¹', 'åˆ©ç‰©æµ¦'],
        'è‹æ ¼å…°': ['çˆ±ä¸å ¡', 'æ ¼æ‹‰æ–¯å“¥', 'é˜¿ä¼¯ä¸'],
        'å¨å°”å£«': ['åŠ è¿ªå¤«', 'æ–¯æ—ºè¥¿']
      }
    };

    // ==================== äº§å“æ•°æ® ====================
    const productNames = [
      'NO.1 ç»å…¸å¤å¤åœ†æ¡†', 'NO.2 è½»å¥¢çŒ«çœ¼æ¡†', 'NO.3 æç®€æ–¹æ¡†',
      'NO.4 é£è¡Œå‘˜æ¡†', 'NO.5 æ–‡è‰ºåŠæ¡†', 'NO.6 æ— æ¡†åˆ‡è¾¹',
      'NO.7 å¤å¤çœ‰çº¿æ¡†', 'NO.8 æç®€é’›æ¶', 'NO.9 å¥¢åçŒ«çœ¼',
      'NO.10 ç»å…¸å¨çµé¡¿'
    ];

    const productImages = [
      'å›¾ç‰‡/1å·b.jpg', 'å›¾ç‰‡/2å·b.jpg', 'å›¾ç‰‡/3å·b.jpg',
      'å›¾ç‰‡/4å·.jpg', 'å›¾ç‰‡/5å·b.jpg', 'å›¾ç‰‡/6å·b.jpg',
      'å›¾ç‰‡/7å·b.jpg', 'å›¾ç‰‡/8å·b.jpg', 'å›¾ç‰‡/9å·ab.jpg',
      'å›¾ç‰‡/10å·ab.jpg'
    ];

    // ==================== ç”¨æˆ·æ•°æ® ====================
    let userData = {
      name: 'å¼ ä¸‰',
      phone: '13800138000',
      birthday: '1990-06-15',
      gender: 'ç”·',
      email: '',
      points: 2580,
      prescription: null,
      orders: [],
      addresses: [
        {
          name: 'å¼ ä¸‰',
          phone: '13800138000',
          country: 'ä¸­å›½å¤§é™†',
          province: 'åŒ—äº¬å¸‚',
          city: 'æœé˜³åŒº',
          detail: 'å»ºå›½è·¯88å·SOHOç°ä»£åŸAåº§1001å®¤',
          isDefault: true
        },
        {
          name: 'æå››',
          phone: '13900139000',
          country: 'ä¸­å›½å¤§é™†',
          province: 'ä¸Šæµ·å¸‚',
          city: 'æµ¦ä¸œæ–°åŒº',
          detail: 'ä¸–çºªå¤§é“100å·ç¯çƒé‡‘èä¸­å¿ƒ50å±‚',
          isDefault: false
        }
      ]
    };

    // ==================== é€€å‡ºç™»å½• ====================
    function handleLogout() {
      if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
        // æ¸…é™¤ç™»å½•çŠ¶æ€
        const savedUser = localStorage.getItem('splurgeVisionUser');
        if (savedUser) {
          const user = JSON.parse(savedUser);
          user.isLoggedIn = false;
          localStorage.setItem('splurgeVisionUser', JSON.stringify(user));
        }
        // æ¸…é™¤è‡ªåŠ¨ç™»å½•
        localStorage.removeItem('splurgeVisionAutoLogin');
        alert('å·²é€€å‡ºç™»å½•');
        window.location.href = 'index.html';
      }
    }

    // ==================== Tab åˆ‡æ¢ ====================
    function switchTab(tab, btn) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
      document.getElementById('tab-' + tab).classList.add('active');
      btn.classList.add('active');
    }

    // ==================== åˆå§‹åŒ– ====================
    function initPage() {
      const savedData = localStorage.getItem('splurgeVisionUser');
      if (savedData) {
        userData = JSON.parse(savedData);
        if (!userData.gender) userData.gender = '';
        if (!userData.email) userData.email = '';
        if (!userData.prescription) userData.prescription = null;
        if (!userData.orders) userData.orders = [];
      }

      document.getElementById('userName').textContent = userData.name;
      document.getElementById('userPhone').textContent = userData.phone.replace(/(\d{3})\d{4}(\d{4})/, '$1****$2');
      document.getElementById('userBirthday').textContent = userData.birthday;
      document.getElementById('userPoints').textContent = userData.points.toLocaleString();

      document.getElementById('infoName').textContent = userData.name || 'â€”';
      document.getElementById('infoPhone').textContent = userData.phone || 'â€”';
      document.getElementById('infoBirthday').textContent = userData.birthday || 'â€”';
      document.getElementById('infoGender').textContent = userData.gender || 'â€”';
      document.getElementById('infoEmail').textContent = userData.email || 'â€”';

      checkBirthday();
      renderPrescription();
      renderOrders();
      renderAddressList();
    }

    // ==================== ç”Ÿæ—¥æ£€æŸ¥ ====================
    function checkBirthday() {
      const today = new Date();
      const birthday = new Date(userData.birthday);
      if (today.getMonth() === birthday.getMonth() && today.getDate() === birthday.getDate()) {
        document.getElementById('birthdayReminder').style.display = 'block';
      }
    }

    // ==================== ä¸ªäººä¿¡æ¯ç¼–è¾‘ ====================
    function openEditProfileModal() {
      document.getElementById('editName').value = userData.name || '';
      document.getElementById('editPhone').value = userData.phone || '';
      document.getElementById('editBirthday').value = userData.birthday || '';
      document.getElementById('editGender').value = userData.gender || '';
      document.getElementById('editEmail').value = userData.email || '';
      document.getElementById('profileModal').style.display = 'block';
    }

    function saveProfile(event) {
      event.preventDefault();
      userData.name = document.getElementById('editName').value;
      userData.phone = document.getElementById('editPhone').value;
      userData.birthday = document.getElementById('editBirthday').value;
      userData.gender = document.getElementById('editGender').value;
      userData.email = document.getElementById('editEmail').value;

      localStorage.setItem('splurgeVisionUser', JSON.stringify(userData));
      closeModal('profileModal');
      initPage();
      alert('ä¸ªäººä¿¡æ¯å·²ä¿å­˜ï¼');
    }

    // ==================== éªŒå…‰å¤„æ–¹ ====================
    function renderPrescription() {
      const container = document.getElementById('prescriptionContent');
      const rx = userData.prescription;

      if (!rx) {
        container.innerHTML = `
          <div class="prescription-empty">
            <p style="font-size:2rem;margin-bottom:12px;opacity:0.4;">ğŸ‘“</p>
            <p>æš‚æœªå½•å…¥éªŒå…‰å¤„æ–¹</p>
            <p style="font-size:0.85rem;color:#A8B5A0;margin-top:6px;">å½•å…¥æ‚¨çš„åº¦æ•°ä¿¡æ¯ï¼Œæ–¹ä¾¿å¿«é€Ÿé…é•œ</p>
          </div>
        `;
        return;
      }

      container.innerHTML = `
        <table class="prescription-table">
          <thead>
            <tr>
              <th></th>
              <th>çƒé•œ SPH</th>
              <th>æŸ±é•œ CYL</th>
              <th>è½´ä½ AXIS</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="eye-label">å³çœ¼ OD</td>
              <td>${rx.rSph || 'â€”'}</td>
              <td>${rx.rCyl || 'â€”'}</td>
              <td>${rx.rAxis ? rx.rAxis + 'Â°' : 'â€”'}</td>
            </tr>
            <tr>
              <td class="eye-label">å·¦çœ¼ OS</td>
              <td>${rx.lSph || 'â€”'}</td>
              <td>${rx.lCyl || 'â€”'}</td>
              <td>${rx.lAxis ? rx.lAxis + 'Â°' : 'â€”'}</td>
            </tr>
          </tbody>
        </table>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin-top:16px;">
          <div style="background:rgba(155,168,156,0.08);padding:12px 16px;border-radius:10px;">
            <div style="font-size:0.8rem;color:#8B9B8D;margin-bottom:4px;">ç³è· PD</div>
            <div style="font-size:1.1rem;color:#6B7B6D;font-weight:700;">${rx.pd ? rx.pd + ' mm' : 'â€”'}</div>
          </div>
          <div style="background:rgba(155,168,156,0.08);padding:12px 16px;border-radius:10px;">
            <div style="font-size:0.8rem;color:#8B9B8D;margin-bottom:4px;">ç³é«˜ PH</div>
            <div style="font-size:1.1rem;color:#6B7B6D;font-weight:700;">${rx.ph ? rx.ph + ' mm' : 'â€”'}</div>
          </div>
          <div style="background:rgba(155,168,156,0.08);padding:12px 16px;border-radius:10px;">
            <div style="font-size:0.8rem;color:#8B9B8D;margin-bottom:4px;">ADD</div>
            <div style="font-size:1.1rem;color:#6B7B6D;font-weight:700;">${rx.add || 'â€”'}</div>
          </div>
        </div>
        ${rx.note ? `<div style="margin-top:12px;padding:10px 14px;background:rgba(201,169,168,0.1);border-radius:8px;font-size:0.85rem;color:#8B9B8D;">ğŸ“ å¤‡æ³¨ï¼š${rx.note}</div>` : ''}
      `;
    }

    function openPrescriptionModal() {
      const rx = userData.prescription || {};
      document.getElementById('rxRSph').value = rx.rSph || '';
      document.getElementById('rxRCyl').value = rx.rCyl || '';
      document.getElementById('rxRAxis').value = rx.rAxis || '';
      document.getElementById('rxLSph').value = rx.lSph || '';
      document.getElementById('rxLCyl').value = rx.lCyl || '';
      document.getElementById('rxLAxis').value = rx.lAxis || '';
      document.getElementById('rxPD').value = rx.pd || '';
      document.getElementById('rxPH').value = rx.ph || '';
      document.getElementById('rxAdd').value = rx.add || '';
      document.getElementById('rxNote').value = rx.note || '';
      document.getElementById('prescriptionModal').style.display = 'block';
    }

    function savePrescription(event) {
      event.preventDefault();
      userData.prescription = {
        rSph: document.getElementById('rxRSph').value.trim(),
        rCyl: document.getElementById('rxRCyl').value.trim(),
        rAxis: document.getElementById('rxRAxis').value.trim(),
        lSph: document.getElementById('rxLSph').value.trim(),
        lCyl: document.getElementById('rxLCyl').value.trim(),
        lAxis: document.getElementById('rxLAxis').value.trim(),
        pd: document.getElementById('rxPD').value.trim(),
        ph: document.getElementById('rxPH').value.trim(),
        add: document.getElementById('rxAdd').value.trim(),
        note: document.getElementById('rxNote').value.trim()
      };

      localStorage.setItem('splurgeVisionUser', JSON.stringify(userData));
      closeModal('prescriptionModal');
      renderPrescription();
      alert('éªŒå…‰å¤„æ–¹å·²ä¿å­˜ï¼');
    }

    // ==================== è´­ä¹°è®°å½• ====================
    function renderOrders() {
      const container = document.getElementById('orderList');
      const orders = userData.orders || [];

      if (orders.length === 0) {
        container.innerHTML = `
          <div class="order-empty">
            <div class="order-empty-icon">ğŸ›ï¸</div>
            <p>æš‚æ— è´­ä¹°è®°å½•</p>
            <a href="products.html" class="go-shop-btn">å»é€›é€›</a>
          </div>
        `;
        return;
      }

      container.innerHTML = orders.map((order, idx) => {
        const statusClass = order.status === 'å·²å®Œæˆ' ? 'status-completed' :
                            order.status === 'é…é€ä¸­' ? 'status-shipping' : 'status-processing';
        
        const productsHtml = order.items.map(item => {
          const imgSrc = productImages[item.productId - 1] || 'å›¾ç‰‡/1å·b.jpg';
          const pName = productNames[item.productId - 1] || 'çœ¼é•œ';
          return `
            <div class="order-product">
              <img src="${imgSrc}" alt="${pName}" class="order-product-img">
              <div class="order-product-info">
                <div class="order-product-name">${pName}</div>
                <div class="order-product-spec">${item.variant || 'æ ‡å‡†æ¬¾'}${item.lens ? ' | ' + item.lens : ''}</div>
              </div>
              <div style="text-align:right;">
                <div class="order-product-price">Â¥${item.price}</div>
                <div class="order-product-qty">x${item.qty}</div>
              </div>
            </div>
          `;
        }).join('');

        return `
          <div class="order-item">
            <div class="order-header">
              <div>
                <div class="order-id">è®¢å•å·ï¼š${order.orderId}</div>
                <div class="order-date">${order.date}</div>
              </div>
              <span class="order-status ${statusClass}">${order.status}</span>
            </div>
            <div class="order-products">${productsHtml}</div>
            <div class="order-footer">
              <div class="order-total"><span>åˆè®¡</span>Â¥${order.total}</div>
              <div class="order-actions">
                ${order.status === 'å·²å®Œæˆ' ? '<button class="btn btn-edit" onclick="alert(\'æ„Ÿè°¢æ‚¨çš„è¯„ä»·ï¼\')">è¯„ä»·</button>' : ''}
                <button class="btn btn-default" onclick="alert(\'è®¢å•è¯¦æƒ…åŠŸèƒ½å¼€å‘ä¸­\')">è¯¦æƒ…</button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // ==================== åœ°å€ç®¡ç† ====================
    function renderAddressList() {
      const listElement = document.getElementById('addressList');
      listElement.innerHTML = '';

      userData.addresses.forEach((address, index) => {
        const addressItem = document.createElement('div');
        addressItem.className = 'address-item' + (address.isDefault ? ' default' : '');
        
        addressItem.innerHTML = `
          ${address.isDefault ? '<span class="address-badge">é»˜è®¤åœ°å€</span>' : ''}
          <div class="address-name">${address.name}</div>
          <div class="address-phone">${address.phone}</div>
          <div class="address-detail">${address.country} ${address.province} ${address.city} ${address.detail}</div>
          <div class="address-actions">
            <button class="btn btn-edit" onclick="editAddress(${index})">ç¼–è¾‘</button>
            <button class="btn btn-delete" onclick="deleteAddress(${index})">åˆ é™¤</button>
            ${!address.isDefault ? `<button class="btn btn-default" onclick="setDefaultAddress(${index})">è®¾ä¸ºé»˜è®¤</button>` : ''}
          </div>
        `;
        
        listElement.appendChild(addressItem);
      });
    }

    function openAddAddressModal() {
      document.getElementById('addressModalTitle').textContent = 'æ·»åŠ æ”¶è´§åœ°å€';
      document.getElementById('editIndex').value = '-1';
      document.getElementById('addressForm').reset();
      document.getElementById('addressModal').style.display = 'block';
    }

    function updateAddressProvinces() {
      const country = document.getElementById('addressCountry').value;
      const provinceSelect = document.getElementById('addressProvince');
      const citySelect = document.getElementById('addressCity');
      
      provinceSelect.innerHTML = '<option value="">é€‰æ‹©çœä»½/å·</option>';
      citySelect.innerHTML = '<option value="">è¯·å…ˆé€‰æ‹©çœä»½</option>';
      
      if (country && addressData[country]) {
        Object.keys(addressData[country]).forEach(province => {
          const option = document.createElement('option');
          option.value = province;
          option.textContent = province;
          provinceSelect.appendChild(option);
        });
      }
    }

    function updateAddressCities() {
      const country = document.getElementById('addressCountry').value;
      const province = document.getElementById('addressProvince').value;
      const citySelect = document.getElementById('addressCity');
      
      citySelect.innerHTML = '<option value="">é€‰æ‹©åŸå¸‚</option>';
      
      if (country && province && addressData[country] && addressData[country][province]) {
        addressData[country][province].forEach(city => {
          const option = document.createElement('option');
          option.value = city;
          option.textContent = city;
          citySelect.appendChild(option);
        });
      }
    }

    function saveAddress(event) {
      event.preventDefault();
      
      const editIndex = parseInt(document.getElementById('editIndex').value);
      const newAddress = {
        name: document.getElementById('addressName').value,
        phone: document.getElementById('addressFormPhone').value,
        country: document.getElementById('addressCountry').value,
        province: document.getElementById('addressProvince').value,
        city: document.getElementById('addressCity').value,
        detail: document.getElementById('addressDetail').value,
        isDefault: userData.addresses.length === 0
      };

      if (editIndex === -1) {
        userData.addresses.push(newAddress);
      } else {
        newAddress.isDefault = userData.addresses[editIndex].isDefault;
        userData.addresses[editIndex] = newAddress;
      }

      localStorage.setItem('splurgeVisionUser', JSON.stringify(userData));
      closeModal('addressModal');
      renderAddressList();
      alert(editIndex === -1 ? 'åœ°å€æ·»åŠ æˆåŠŸï¼' : 'åœ°å€ä¿®æ”¹æˆåŠŸï¼');
    }

    function editAddress(index) {
      const address = userData.addresses[index];
      document.getElementById('addressModalTitle').textContent = 'ç¼–è¾‘æ”¶è´§åœ°å€';
      document.getElementById('editIndex').value = index;
      document.getElementById('addressName').value = address.name;
      document.getElementById('addressFormPhone').value = address.phone;
      document.getElementById('addressCountry').value = address.country;
      
      updateAddressProvinces();
      setTimeout(() => {
        document.getElementById('addressProvince').value = address.province;
        updateAddressCities();
        setTimeout(() => {
          document.getElementById('addressCity').value = address.city;
        }, 50);
      }, 50);
      
      document.getElementById('addressDetail').value = address.detail;
      document.getElementById('addressModal').style.display = 'block';
    }

    function deleteAddress(index) {
      if (userData.addresses[index].isDefault && userData.addresses.length > 1) {
        alert('è¯·å…ˆè®¾ç½®å…¶ä»–åœ°å€ä¸ºé»˜è®¤åœ°å€ï¼Œå†åˆ é™¤å½“å‰åœ°å€');
        return;
      }
      
      if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåœ°å€å—ï¼Ÿ')) {
        userData.addresses.splice(index, 1);
        localStorage.setItem('splurgeVisionUser', JSON.stringify(userData));
        renderAddressList();
      }
    }

    function setDefaultAddress(index) {
      userData.addresses.forEach((addr, i) => {
        addr.isDefault = (i === index);
      });
      localStorage.setItem('splurgeVisionUser', JSON.stringify(userData));
      renderAddressList();
    }

    // ==================== æ¨¡æ€æ¡†é€šç”¨ ====================
    function closeModal(id) {
      document.getElementById(id).style.display = 'none';
    }

    window.onclick = function(event) {
      ['profileModal', 'prescriptionModal', 'addressModal'].forEach(id => {
        const modal = document.getElementById(id);
        if (event.target === modal) closeModal(id);
      });
    };

    // ==================== å¯åŠ¨ ====================
    initPage();
  </script>
</body>
</html>

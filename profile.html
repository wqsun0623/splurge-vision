<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸ªäººä¸­å¿ƒ - Splurge Vision</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(135deg, #EFE9E3 0%, #E2D8D0 25%, #D9CECA 50%, #C8B8B0 75%, #BFA99F 100%);
      background-attachment: fixed;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      margin-bottom: 30px;
    }

    .header h1 {
      color: #6B7B6D;
      font-size: 2rem;
      font-weight: 700;
    }

    .back-btn {
      padding: 12px 24px;
      background: linear-gradient(135deg, #9BA89C 0%, #6B7B6D 100%);
      color: white;
      text-decoration: none;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.3s;
    }

    .back-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(107, 123, 109, 0.4);
    }

    .profile-grid {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .profile-card {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .user-info {
      text-align: center;
    }

    .user-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: linear-gradient(135deg, #9BA89C 0%, #6B7B6D 100%);
      margin: 0 auto 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: white;
    }

    .user-name {
      font-size: 1.5rem;
      color: #6B7B6D;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .user-phone {
      color: #8B9B8D;
      font-size: 0.9rem;
      margin-bottom: 20px;
    }

    .points-section {
      background: linear-gradient(135deg, rgba(155, 168, 156, 0.2) 0%, rgba(107, 123, 109, 0.15) 100%);
      border-radius: 15px;
      padding: 20px;
      margin-top: 20px;
    }

    .points-display {
      text-align: center;
      padding: 20px;
    }

    .points-number {
      font-size: 2.5rem;
      color: #6B7B6D;
      font-weight: 900;
      margin-bottom: 5px;
    }

    .points-label {
      color: #8B9B8D;
      font-size: 0.9rem;
    }

    .points-rules {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid rgba(107, 123, 109, 0.2);
    }

    .points-rules h3 {
      color: #6B7B6D;
      font-size: 1rem;
      margin-bottom: 10px;
      font-weight: 700;
    }

    .points-rules ul {
      list-style: none;
      padding: 0;
    }

    .points-rules li {
      color: #6B7B6D;
      font-size: 0.85rem;
      padding: 5px 0;
      padding-left: 20px;
      position: relative;
    }

    .points-rules li:before {
      content: "âœ“";
      position: absolute;
      left: 0;
      color: #9BA89C;
      font-weight: bold;
    }

    .section-title {
      color: #6B7B6D;
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .address-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .address-item {
      background: rgba(255, 255, 255, 0.5);
      border-radius: 12px;
      padding: 20px;
      border: 2px solid transparent;
      transition: all 0.3s;
      position: relative;
    }

    .address-item.default {
      border-color: #9BA89C;
    }

    .address-item:hover {
      border-color: #6B7B6D;
      box-shadow: 0 2px 10px rgba(107, 123, 109, 0.2);
    }

    .address-badge {
      display: inline-block;
      background: linear-gradient(135deg, #9BA89C 0%, #6B7B6D 100%);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .address-name {
      font-size: 1.1rem;
      color: #6B7B6D;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .address-phone {
      color: #8B9B8D;
      font-size: 0.9rem;
      margin-bottom: 8px;
    }

    .address-detail {
      color: #6B7B6D;
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .address-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-edit {
      background: linear-gradient(135deg, #9BA89C 0%, #6B7B6D 100%);
      color: white;
    }

    .btn-delete {
      background: rgba(200, 100, 100, 0.8);
      color: white;
    }

    .btn-default {
      background: rgba(155, 168, 156, 0.3);
      color: #6B7B6D;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .add-address-btn {
      width: 100%;
      padding: 15px;
      background: rgba(155, 168, 156, 0.3);
      border: 2px dashed #9BA89C;
      border-radius: 12px;
      color: #6B7B6D;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .add-address-btn:hover {
      background: rgba(155, 168, 156, 0.5);
      border-color: #6B7B6D;
    }

    .birthday-reminder {
      background: linear-gradient(135deg, rgba(255, 200, 150, 0.3) 0%, rgba(255, 180, 120, 0.2) 100%);
      border-left: 4px solid #FFA500;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-size: 0.85rem;
      color: #6B7B6D;
    }

    .birthday-reminder strong {
      color: #FF8C00;
    }

    @media (max-width: 968px) {
      .profile-grid {
        grid-template-columns: 1fr;
      }
    }

    /* æ¨¡æ€æ¡†æ ·å¼ */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
    }

    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-close {
      position: absolute;
      right: 20px;
      top: 20px;
      font-size: 28px;
      font-weight: bold;
      color: #999;
      cursor: pointer;
      transition: color 0.2s;
    }

    .modal-close:hover {
      color: #333;
    }

    .modal-title {
      text-align: center;
      font-size: 1.5rem;
      color: #6B7B6D;
      margin-bottom: 25px;
      font-weight: 700;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      color: #6B7B6D;
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .form-input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid rgba(107, 123, 109, 0.3);
      border-radius: 10px;
      font-size: 1rem;
      transition: all 0.3s;
      background: rgba(255, 255, 255, 0.8);
      font-family: 'Montserrat', sans-serif;
    }

    .form-input:focus {
      outline: none;
      border-color: #6B7B6D;
      background: white;
    }

    .form-submit {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #9BA89C 0%, #6B7B6D 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 10px;
    }

    .form-submit:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(107, 123, 109, 0.4);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ‘¤ ä¸ªäººä¸­å¿ƒ</h1>
      <a href="index.html" class="back-btn">è¿”å›é¦–é¡µ</a>
    </div>

    <div class="profile-grid">
      <!-- å·¦ä¾§ç”¨æˆ·ä¿¡æ¯ -->
      <div class="profile-card user-info">
        <div class="user-avatar">ğŸ‘¤</div>
        <div class="user-name" id="userName">ç”¨æˆ·å</div>
        <div class="user-phone" id="userPhone">138****8888</div>
        <div class="user-phone" style="margin-top: 5px;">ğŸ‚ ç”Ÿæ—¥ï¼š<span id="userBirthday">1990-01-01</span></div>

        <div class="points-section">
          <div class="points-display">
            <div class="points-number" id="userPoints">0</div>
            <div class="points-label">æˆ‘çš„ç§¯åˆ†</div>
          </div>

          <div class="points-rules">
            <h3>ğŸ’° ç§¯åˆ†è§„åˆ™</h3>
            <ul>
              <li>æ¶ˆè´¹1å…ƒç§¯1åˆ†</li>
              <li>è¾¾åˆ°1500ç§¯åˆ†åï¼Œ100åˆ†å¯æŠµæ‰£1å…ƒ</li>
              <li>ç”Ÿæ—¥å½“å¤©æ¶ˆè´¹äº«åŒå€ç§¯åˆ†</li>
              <li>ç§¯åˆ†æ°¸ä¹…æœ‰æ•ˆï¼Œä¸æ¸…é›¶</li>
            </ul>
          </div>

          <div class="birthday-reminder" id="birthdayReminder" style="display: none;">
            <strong>ğŸ‰ ä»Šå¤©æ˜¯æ‚¨çš„ç”Ÿæ—¥ï¼</strong><br>
            ç”Ÿæ—¥å½“å¤©æ¶ˆè´¹å¯äº«å—åŒå€ç§¯åˆ†ä¼˜æƒ å“¦ï¼
          </div>
        </div>
      </div>

      <!-- å³ä¾§åœ°å€ç®¡ç† -->
      <div class="profile-card">
        <h2 class="section-title">ğŸ“ æ”¶è´§åœ°å€ç®¡ç†</h2>
        
        <div class="address-list" id="addressList">
          <!-- åœ°å€åˆ—è¡¨å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <button class="add-address-btn" onclick="openAddAddressModal()">
          <span style="font-size: 1.5rem;">+</span>
          æ·»åŠ æ–°åœ°å€
        </button>
      </div>
    </div>
  </div>

  <!-- æ·»åŠ /ç¼–è¾‘åœ°å€æ¨¡æ€æ¡† -->
  <div id="addressModal" class="modal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeAddressModal()">&times;</span>
      <h2 class="modal-title" id="modalTitle">æ·»åŠ æ”¶è´§åœ°å€</h2>
      <form id="addressForm" onsubmit="saveAddress(event)">
        <input type="hidden" id="editIndex" value="-1">
        
        <div class="form-group">
          <label class="form-label">æ”¶è´§äººå§“å</label>
          <input type="text" class="form-input" id="addressName" placeholder="è¯·è¾“å…¥æ”¶è´§äººå§“å" required>
        </div>

        <div class="form-group">
          <label class="form-label">è”ç³»ç”µè¯</label>
          <input type="tel" class="form-input" id="addressPhone" placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯" pattern="[0-9]{11}" required>
        </div>

        <div class="form-group">
          <label class="form-label">å›½å®¶/åœ°åŒº</label>
          <select class="form-input" id="addressCountry" onchange="updateAddressProvinces()" required>
            <option value="">é€‰æ‹©å›½å®¶/åœ°åŒº</option>
            <option value="ä¸­å›½å¤§é™†">ä¸­å›½å¤§é™†</option>
            <option value="é¦™æ¸¯">é¦™æ¸¯</option>
            <option value="æ¾³é—¨">æ¾³é—¨</option>
            <option value="å°æ¹¾">å°æ¹¾</option>
            <option value="æ—¥æœ¬">æ—¥æœ¬</option>
            <option value="éŸ©å›½">éŸ©å›½</option>
            <option value="è‹±å›½">è‹±å›½</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">çœä»½/å·</label>
          <select class="form-input" id="addressProvince" onchange="updateAddressCities()" required>
            <option value="">è¯·å…ˆé€‰æ‹©å›½å®¶</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">åŸå¸‚</label>
          <select class="form-input" id="addressCity" required>
            <option value="">è¯·å…ˆé€‰æ‹©çœä»½</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">è¯¦ç»†åœ°å€</label>
          <input type="text" class="form-input" id="addressDetail" placeholder="è¡—é“ã€é—¨ç‰Œå·ç­‰" required>
        </div>

        <button type="submit" class="form-submit">ä¿å­˜åœ°å€</button>
      </form>
    </div>
  </div>

  <script>
    // åœ°å€æ•°æ®
    const addressData = {
      'ä¸­å›½å¤§é™†': {
        'åŒ—äº¬å¸‚': ['ä¸œåŸåŒº', 'è¥¿åŸåŒº', 'æœé˜³åŒº', 'æµ·æ·€åŒº', 'ä¸°å°åŒº', 'çŸ³æ™¯å±±åŒº', 'é—¨å¤´æ²ŸåŒº', 'æˆ¿å±±åŒº', 'é€šå·åŒº', 'é¡ºä¹‰åŒº', 'æ˜Œå¹³åŒº', 'å¤§å…´åŒº', 'å¹³è°·åŒº', 'æ€€æŸ”åŒº', 'å¯†äº‘åŒº', 'å»¶åº†åŒº'],
        'ä¸Šæµ·å¸‚': ['é»„æµ¦åŒº', 'å¾æ±‡åŒº', 'é•¿å®åŒº', 'é™å®‰åŒº', 'æ™®é™€åŒº', 'è™¹å£åŒº', 'æ¨æµ¦åŒº', 'æµ¦ä¸œæ–°åŒº', 'é—µè¡ŒåŒº', 'å®å±±åŒº', 'å˜‰å®šåŒº', 'é‡‘å±±åŒº', 'æ¾æ±ŸåŒº', 'é’æµ¦åŒº', 'å¥‰è´¤åŒº', 'å´‡æ˜åŒº'],
        'å¹¿ä¸œçœ': ['å¹¿å·å¸‚', 'æ·±åœ³å¸‚', 'ç æµ·å¸‚', 'ä¸œèå¸‚', 'ä½›å±±å¸‚', 'ä¸­å±±å¸‚', 'æƒ å·å¸‚', 'æ±•å¤´å¸‚', 'æ±Ÿé—¨å¸‚', 'è‚‡åº†å¸‚'],
        'æµ™æ±Ÿçœ': ['æ­å·å¸‚', 'å®æ³¢å¸‚', 'æ¸©å·å¸‚', 'å˜‰å…´å¸‚', 'æ¹–å·å¸‚', 'ç»å…´å¸‚', 'é‡‘åå¸‚', 'å°å·å¸‚'],
        'æ±Ÿè‹çœ': ['å—äº¬å¸‚', 'è‹å·å¸‚', 'æ— é”¡å¸‚', 'å¸¸å·å¸‚', 'å—é€šå¸‚', 'æ‰¬å·å¸‚', 'å¾å·å¸‚', 'ç›åŸå¸‚'],
        'æ¹–åŒ—çœ': ['æ­¦æ±‰å¸‚', 'å®œæ˜Œå¸‚', 'è¥„é˜³å¸‚', 'è†å·å¸‚', 'åå °å¸‚', 'å­æ„Ÿå¸‚'],
        'æ¹–å—çœ': ['é•¿æ²™å¸‚', 'æ ªæ´²å¸‚', 'å²³é˜³å¸‚', 'è¡¡é˜³å¸‚', 'é‚µé˜³å¸‚', 'å¸¸å¾·å¸‚'],
        'å››å·çœ': ['æˆéƒ½å¸‚', 'ç»µé˜³å¸‚', 'å¾·é˜³å¸‚', 'å—å……å¸‚', 'ä¹å±±å¸‚', 'å®œå®¾å¸‚'],
        'å±±ä¸œçœ': ['æµå—å¸‚', 'é’å²›å¸‚', 'çƒŸå°å¸‚', 'å¨æµ·å¸‚', 'æ½åŠå¸‚', 'æ·„åšå¸‚'],
        'ç¦å»ºçœ': ['ç¦å·å¸‚', 'å¦é—¨å¸‚', 'æ³‰å·å¸‚', 'æ¼³å·å¸‚', 'è†ç”°å¸‚']
      },
      'é¦™æ¸¯': {
        'é¦™æ¸¯å²›': ['ä¸­è¥¿åŒº', 'æ¹¾ä»”åŒº', 'ä¸œåŒº', 'å—åŒº'],
        'ä¹é¾™': ['æ²¹å°–æ—ºåŒº', 'æ·±æ°´åŸ—åŒº', 'ä¹é¾™åŸåŒº', 'é»„å¤§ä»™åŒº', 'è§‚å¡˜åŒº'],
        'æ–°ç•Œ': ['èƒæ¹¾åŒº', 'å±¯é—¨åŒº', 'å…ƒæœ—åŒº', 'åŒ—åŒº', 'å¤§åŸ”åŒº', 'æ²™ç”°åŒº']
      },
      'æ¾³é—¨': {
        'æ¾³é—¨åŠå²›': ['èŠ±åœ°ç›å ‚åŒº', 'åœ£å®‰å¤šå°¼å ‚åŒº', 'å¤§å ‚åŒº', 'æœ›å¾·å ‚åŒº', 'é£é¡ºå ‚åŒº'],
        'ç¦»å²›': ['å˜‰æ¨¡å ‚åŒº', 'åœ£æ–¹æµå„å ‚åŒº']
      },
      'å°æ¹¾': {
        'å°åŒ—å¸‚': ['ä¸­æ­£åŒº', 'å¤§åŒåŒº', 'ä¸­å±±åŒº', 'æ¾å±±åŒº', 'å¤§å®‰åŒº', 'ä¸‡ååŒº'],
        'æ–°åŒ—å¸‚': ['æ¿æ¡¥åŒº', 'ä¸‰é‡åŒº', 'ä¸­å’ŒåŒº', 'æ°¸å’ŒåŒº', 'æ–°åº„åŒº', 'æ–°åº—åŒº'],
        'å°ä¸­å¸‚': ['ä¸­åŒº', 'ä¸œåŒº', 'å—åŒº', 'è¥¿åŒº', 'åŒ—åŒº', 'è¥¿å±¯åŒº']
      },
      'æ—¥æœ¬': {
        'ä¸œäº¬éƒ½': ['åƒä»£ç”°åŒº', 'ä¸­å¤®åŒº', 'æ¸¯åŒº', 'æ–°å®¿åŒº', 'æ¶©è°·åŒº', 'å“å·åŒº'],
        'å¤§é˜ªåºœ': ['å¤§é˜ªå¸‚', 'å ºå¸‚', 'ä¸œå¤§é˜ªå¸‚', 'è±Šä¸­å¸‚'],
        'äº¬éƒ½åºœ': ['äº¬éƒ½å¸‚', 'å®‡æ²»å¸‚', 'äº€å²¡å¸‚']
      },
      'éŸ©å›½': {
        'é¦–å°”ç‰¹åˆ«å¸‚': ['æ±Ÿå—åŒº', 'æ±ŸåŒ—åŒº', 'éº»æµ¦åŒº', 'é’Ÿè·¯åŒº', 'ä¸­åŒº'],
        'é‡œå±±å¹¿åŸŸå¸‚': ['æµ·äº‘å°åŒº', 'å—åŒº', 'ä¸œåŒº', 'è¥¿åŒº', 'ä¸­åŒº'],
        'ä»å·å¹¿åŸŸå¸‚': ['ä¸­åŒº', 'ä¸œåŒº', 'å—åŒº', 'å»¶å¯¿åŒº']
      },
      'è‹±å›½': {
        'è‹±æ ¼å…°': ['ä¼¦æ•¦', 'æ›¼å½»æ–¯ç‰¹', 'ä¼¯æ˜ç¿°', 'åˆ©å…¹', 'åˆ©ç‰©æµ¦'],
        'è‹æ ¼å…°': ['çˆ±ä¸å ¡', 'æ ¼æ‹‰æ–¯å“¥', 'é˜¿ä¼¯ä¸'],
        'å¨å°”å£«': ['åŠ è¿ªå¤«', 'æ–¯æ—ºè¥¿']
      }
    };

    // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®
    let userData = {
      name: 'å¼ ä¸‰',
      phone: '13800138000',
      birthday: '1990-06-15',
      points: 2580,
      addresses: [
        {
          name: 'å¼ ä¸‰',
          phone: '13800138000',
          country: 'ä¸­å›½å¤§é™†',
          province: 'åŒ—äº¬å¸‚',
          city: 'æœé˜³åŒº',
          detail: 'å»ºå›½è·¯88å·SOHOç°ä»£åŸAåº§1001å®¤',
          isDefault: true
        },
        {
          name: 'æå››',
          phone: '13900139000',
          country: 'ä¸­å›½å¤§é™†',
          province: 'ä¸Šæµ·å¸‚',
          city: 'æµ¦ä¸œæ–°åŒº',
          detail: 'ä¸–çºªå¤§é“100å·ç¯çƒé‡‘èä¸­å¿ƒ50å±‚',
          isDefault: false
        }
      ]
    };

    // åˆå§‹åŒ–é¡µé¢
    function initPage() {
      // å°è¯•ä»localStorageåŠ è½½ç”¨æˆ·æ•°æ®
      const savedData = localStorage.getItem('splurgeVisionUser');
      if (savedData) {
        userData = JSON.parse(savedData);
      }

      // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
      document.getElementById('userName').textContent = userData.name;
      document.getElementById('userPhone').textContent = userData.phone.replace(/(\d{3})\d{4}(\d{4})/, '$1****$2');
      document.getElementById('userBirthday').textContent = userData.birthday;
      document.getElementById('userPoints').textContent = userData.points.toLocaleString();

      // æ£€æŸ¥æ˜¯å¦æ˜¯ç”Ÿæ—¥
      checkBirthday();

      // æ¸²æŸ“åœ°å€åˆ—è¡¨
      renderAddressList();
    }

    // æ£€æŸ¥æ˜¯å¦æ˜¯ç”Ÿæ—¥
    function checkBirthday() {
      const today = new Date();
      const birthday = new Date(userData.birthday);
      if (today.getMonth() === birthday.getMonth() && today.getDate() === birthday.getDate()) {
        document.getElementById('birthdayReminder').style.display = 'block';
      }
    }

    // æ¸²æŸ“åœ°å€åˆ—è¡¨
    function renderAddressList() {
      const listElement = document.getElementById('addressList');
      listElement.innerHTML = '';

      userData.addresses.forEach((address, index) => {
        const addressItem = document.createElement('div');
        addressItem.className = 'address-item' + (address.isDefault ? ' default' : '');
        
        addressItem.innerHTML = `
          ${address.isDefault ? '<span class="address-badge">é»˜è®¤åœ°å€</span>' : ''}
          <div class="address-name">${address.name}</div>
          <div class="address-phone">${address.phone}</div>
          <div class="address-detail">${address.country} ${address.province} ${address.city} ${address.detail}</div>
          <div class="address-actions">
            <button class="btn btn-edit" onclick="editAddress(${index})">ç¼–è¾‘</button>
            <button class="btn btn-delete" onclick="deleteAddress(${index})">åˆ é™¤</button>
            ${!address.isDefault ? `<button class="btn btn-default" onclick="setDefaultAddress(${index})">è®¾ä¸ºé»˜è®¤</button>` : ''}
          </div>
        `;
        
        listElement.appendChild(addressItem);
      });
    }

    // æ‰“å¼€æ·»åŠ åœ°å€æ¨¡æ€æ¡†
    function openAddAddressModal() {
      document.getElementById('modalTitle').textContent = 'æ·»åŠ æ”¶è´§åœ°å€';
      document.getElementById('editIndex').value = '-1';
      document.getElementById('addressForm').reset();
      document.getElementById('addressModal').style.display = 'block';
    }

    // å…³é—­åœ°å€æ¨¡æ€æ¡†
    function closeAddressModal() {
      document.getElementById('addressModal').style.display = 'none';
    }

    // æ›´æ–°çœä»½é€‰æ‹©
    function updateAddressProvinces() {
      const country = document.getElementById('addressCountry').value;
      const provinceSelect = document.getElementById('addressProvince');
      const citySelect = document.getElementById('addressCity');
      
      provinceSelect.innerHTML = '<option value="">é€‰æ‹©çœä»½/å·</option>';
      citySelect.innerHTML = '<option value="">è¯·å…ˆé€‰æ‹©çœä»½</option>';
      
      if (country && addressData[country]) {
        const provinces = Object.keys(addressData[country]);
        provinces.forEach(province => {
          const option = document.createElement('option');
          option.value = province;
          option.textContent = province;
          provinceSelect.appendChild(option);
        });
      }
    }

    // æ›´æ–°åŸå¸‚é€‰æ‹©
    function updateAddressCities() {
      const country = document.getElementById('addressCountry').value;
      const province = document.getElementById('addressProvince').value;
      const citySelect = document.getElementById('addressCity');
      
      citySelect.innerHTML = '<option value="">é€‰æ‹©åŸå¸‚</option>';
      
      if (country && province && addressData[country] && addressData[country][province]) {
        const cities = addressData[country][province];
        cities.forEach(city => {
          const option = document.createElement('option');
          option.value = city;
          option.textContent = city;
          citySelect.appendChild(option);
        });
      }
    }

    // ä¿å­˜åœ°å€
    function saveAddress(event) {
      event.preventDefault();
      
      const editIndex = parseInt(document.getElementById('editIndex').value);
      const newAddress = {
        name: document.getElementById('addressName').value,
        phone: document.getElementById('addressPhone').value,
        country: document.getElementById('addressCountry').value,
        province: document.getElementById('addressProvince').value,
        city: document.getElementById('addressCity').value,
        detail: document.getElementById('addressDetail').value,
        isDefault: userData.addresses.length === 0 // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªåœ°å€ï¼Œè‡ªåŠ¨è®¾ä¸ºé»˜è®¤
      };

      if (editIndex === -1) {
        // æ·»åŠ æ–°åœ°å€
        userData.addresses.push(newAddress);
      } else {
        // ç¼–è¾‘ç°æœ‰åœ°å€
        newAddress.isDefault = userData.addresses[editIndex].isDefault;
        userData.addresses[editIndex] = newAddress;
      }

      // ä¿å­˜åˆ°localStorage
      localStorage.setItem('splurgeVisionUser', JSON.stringify(userData));

      closeAddressModal();
      renderAddressList();
      alert(editIndex === -1 ? 'åœ°å€æ·»åŠ æˆåŠŸï¼' : 'åœ°å€ä¿®æ”¹æˆåŠŸï¼');
    }

    // ç¼–è¾‘åœ°å€
    function editAddress(index) {
      const address = userData.addresses[index];
      document.getElementById('modalTitle').textContent = 'ç¼–è¾‘æ”¶è´§åœ°å€';
      document.getElementById('editIndex').value = index;
      document.getElementById('addressName').value = address.name;
      document.getElementById('addressPhone').value = address.phone;
      document.getElementById('addressCountry').value = address.country;
      
      updateAddressProvinces();
      setTimeout(() => {
        document.getElementById('addressProvince').value = address.province;
        updateAddressCities();
        setTimeout(() => {
          document.getElementById('addressCity').value = address.city;
        }, 50);
      }, 50);
      
      document.getElementById('addressDetail').value = address.detail;
      document.getElementById('addressModal').style.display = 'block';
    }

    // åˆ é™¤åœ°å€
    function deleteAddress(index) {
      if (userData.addresses[index].isDefault && userData.addresses.length > 1) {
        alert('è¯·å…ˆè®¾ç½®å…¶ä»–åœ°å€ä¸ºé»˜è®¤åœ°å€ï¼Œå†åˆ é™¤å½“å‰åœ°å€');
        return;
      }
      
      if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåœ°å€å—ï¼Ÿ')) {
        userData.addresses.splice(index, 1);
        localStorage.setItem('splurgeVisionUser', JSON.stringify(userData));
        renderAddressList();
      }
    }

    // è®¾ä¸ºé»˜è®¤åœ°å€
    function setDefaultAddress(index) {
      userData.addresses.forEach((addr, i) => {
        addr.isDefault = (i === index);
      });
      localStorage.setItem('splurgeVisionUser', JSON.stringify(userData));
      renderAddressList();
    }

    // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
    window.onclick = function(event) {
      const modal = document.getElementById('addressModal');
      if (event.target === modal) {
        closeAddressModal();
      }
    };

    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    initPage();
  </script>
</body>
</html>
